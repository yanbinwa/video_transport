import unittest

from core.utils.srt import srt_generate

ret = {"key": "test",
       "text": "根据视频的字幕详细总结，视频的内容包括，视频可能的详细类型、mysql教程、英文电视剧、电影片段、日本动漫、关于某某的视频会议、关于某某的中文演讲等等。",
       "timestamp": [[210, 410], [410, 650], [690, 870], [870, 1110], [1110, 1250], [1250, 1470], [1470, 1710],
                     [2030, 2270], [2310, 2550], [2590, 2790], [2790, 3030], [3050, 3210], [3210, 3450], [3450, 3590],
                     [3590, 3750], [3750, 3990], [4330, 4570], [4590, 4830], [4850, 5050], [5050, 5290], [5330, 5530],
                     [5530, 5710], [5710, 5930], [5930, 6130], [6130, 6370], [6390, 6550], [6550, 6790], [7030, 7790],
                     [7790, 7990], [7990, 8230], [8570, 8810], [8810, 9030], [9030, 9230], [9230, 9410], [9410, 9650],
                     [9750, 9890], [9890, 10130], [10170, 10370], [10370, 10610], [10850, 11090], [11090, 11330],
                     [11350, 11570], [11570, 11810], [12030, 12230], [12230, 12470], [12550, 12770], [12770, 12930],
                     [12930, 13150], [13150, 13350], [13350, 13590], [13610, 13830], [13830, 14070], [14370, 14610],
                     [14610, 14850], [14870, 15090], [15090, 15330], [15330, 15550], [15550, 15750], [15750, 15970],
                     [15970, 16170], [16170, 16410], [16490, 16710], [16710, 17065]], "sentence_info": [
        {"text": "根据视频的字幕详细总结，", "start": 210, "end": 3030,
         "timestamp": [[210, 410], [410, 650], [690, 870], [870, 1110], [1110, 1250], [1250, 1470], [1470, 1710],
                       [2030, 2270], [2310, 2550], [2590, 2790], [2790, 3030]], "spk": 0},
        {"text": "视频的内容包括，", "start": 3050, "end": 4830,
         "timestamp": [[3050, 3210], [3210, 3450], [3450, 3590], [3590, 3750], [3750, 3990], [4330, 4570],
                       [4590, 4830]], "spk": 0}, {"text": "视频可能的详细类型、", "start": 4850, "end": 6790,
                                                  "timestamp": [[4850, 5050], [5050, 5290], [5330, 5530], [5530, 5710],
                                                                [5710, 5930], [5930, 6130], [6130, 6370], [6390, 6550],
                                                                [6550, 6790]], "spk": 0},
        {"text": " mysql 教程、", "start": 7030, "end": 8230, "timestamp": [[7030, 7790], [7790, 7990], [7990, 8230]],
         "spk": 0}, {"text": "英文电视剧、", "start": 8570, "end": 9650,
                     "timestamp": [[8570, 8810], [8810, 9030], [9030, 9230], [9230, 9410], [9410, 9650]], "spk": 0},
        {"text": "电影片段、", "start": 9750, "end": 10610,
         "timestamp": [[9750, 9890], [9890, 10130], [10170, 10370], [10370, 10610]], "spk": 0},
        {"text": "日本动漫、", "start": 10850, "end": 11810,
         "timestamp": [[10850, 11090], [11090, 11330], [11350, 11570], [11570, 11810]], "spk": 0},
        {"text": "关于某某的视频会议、", "start": 12030, "end": 14070,
         "timestamp": [[12030, 12230], [12230, 12470], [12550, 12770], [12770, 12930], [12930, 13150], [13150, 13350],
                       [13350, 13590], [13610, 13830], [13830, 14070]], "spk": 0},
        {"text": "关于某某的中文演讲等等。", "start": 14370, "end": 17065,
         "timestamp": [[14370, 14610], [14610, 14850], [14870, 15090], [15090, 15330], [15330, 15550], [15550, 15750],
                       [15750, 15970], [15970, 16170], [16170, 16410], [16490, 16710], [16710, 17065]], "spk": 0}]}


class SrtGenerateTest(unittest.TestCase):

    def test_generate_srt_file(self):
        AssertionError(srt_generate.generate_srt_file(ret["sentence_info"], "../../file/v1.srt"))

    def test_extract_srt_from_audio(self):
        # 返回结果为非空数组
        AssertionError(len(srt_generate.extract_srt_from_audio("../../file/test.mp3")) > 0)

    def test_generate_srt_file_by_audio(self):
        AssertionError(srt_generate.generate_srt_file_by_audio("../../file/test.mp3", "../../file/v1.srt"))

    def test_parser_time(self):
        start_time = srt_generate.parse_time("13:18:35,000")
        print(start_time)

    def test_get_subtitle_from_srt(self):
        subtitle = srt_generate.get_subtitle_from_srt("../file/test2.srt", 0, 100)
        print(subtitle)

